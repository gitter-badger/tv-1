<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <title>我的信息</title>
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <!--标准mui.css-->
        {CSS href='__ADDONSTATIC__mui/css/mui.min.css' /}
        {CSS href='__ADDONSTATIC__mui/css/mui.picker.css' /}
        {CSS href='__ADDONSTATIC__mui/css/mui.poppicker.css' /}
        {CSS href='__ADDONSTATIC__mui/css/mui.picker.min.css' /}
        <!--App自定义的css-->
        {CSS href='__ADDONSTATIC__mui/css/app.css' /}
        {js href='__STATIC__jquery/jquery-1.11.0.min.js' /}
        {js href='__STATIC__layui/layui.js' /}   
        {:hook('Jssdk')}
        <style>
            
        </style>
    </head>
    <body>
        <div class="mui-content">
            <div class="mui-content-padded account-info-row">
                <form class="mui-input-group layui-form" action="">
                    <div class="mui-input-row account-head">
                        <img src="{$fansRow.headimgurl}" class="head-img" >
                    </div>
                    <div class="mui-input-row account-input">
                        <label>姓名</label>
                        <input type="text" name="nickname" value="{$fansRow.nickname}">
                    </div>
                    <div class="mui-input-row account-input">
                        <label>手机</label>
                        <input type="tel" name="mobile" value="{$fansRow.mobile}">
                        <button type="button"  class="change-btn"><img src="__ADDONSTATIC__images/icon-edit.png"></button>
                    </div>
                    <div class="mui-input-row hide code-row account-input">
                        <label>验证码</label>
                        <input type="text" name="code" value="">
                        <button type="button"  class="mui-btn-primary code-btn">获取验证码</button>
                    </div>
                    <div class="mui-input-row account-input">
                        <label>性别</label>
                        <input type="hidden" name="sex" id="sex" value="{$fansRow.sex}">
                        <button id='showUserPicker' class="mui-btn mui-btn-block sex-select" type='button'>{if $fansRow.sex == '1'}男{elseif  $fansRow.sex == '2'}女{else}请选择{/if}</button>
                    </div>
                    <div class="mui-input-row account-input">
                        <label>出生年月</label>
                        <input type="hidden"  name="birthday" id="birthday" value="{$fansRow.birthday}">
                        <button id="birthday-select" data-options='{"type":"date"}' class="btn mui-btn mui-btn-block birthday-select">{if $fansRow.birthday != ''}{$fansRow.birthday}{else}请选择{/if}</button>
                    </div>
                    <div class="mui-input-row account-input">
                        <label>身份证号</label>
                        <input type="text" name="card_number" value="{$fansRow.card_number}">
                    </div>
                    <!-- <div class="mui-input-row account-input">
                        <label>邀请码</label>
                        <span style="line-height: 3">{$fansRow.invite_number}</span>
                    </div> -->
                    <div class="mui-button-row account-input">
                        <button class="mui-btn layui-btn layui-col-xs12 account-sub-btn" lay-submit lay-filter="SUBMIT">确认</button>&nbsp;&nbsp;
                        <button type="button" class="mui-btn account-cancel-btn" onclick="window.history.go(-1)">取消</button>
                    </div>
                </form>            
            </div>            
        </div>
    </body>
    {js href='__ADDONSTATIC__mui/js/mui.min.js' /}
    {js href='__ADDONSTATIC__mui/js/mui.picker.js' /}
    {js href='__ADDONSTATIC__mui/js/mui.poppicker.js' /}
    {js href='__ADDONSTATIC__mui/js/mui.picker.min.js' /}
    {js href='__ADDONSTATIC__js/code.js' /}
    <script>
        layui.use(['form','layer'], function(){
            var form = layui.form;
            var layer = layui.layer;
            form.on('submit(SUBMIT)', function(data){
                var index=layer.load(1)
                $.post('',data.field,function (res) {
                    layer.close(index);                
                    layer.msg(res.msg);
                })
                return false;
            });
        });

        $('.change-btn').on('click', function(){
            $(".code-row").removeClass('hide');
        });

        /**
         * 获取短信验证码
         */
        $('.code-btn').on('click', function(){
            buttonCountdown($(this), 1000 * 60 * 3, "ss");
            layui.use('layer', function(){
                var layer = layui.layer;
                var index=layer.load(1)
                $.post("{:addonUrl('getCode')}",{
                    'mobile':$("input[name='mobile']").val()
                },function (res) {
                    layer.close(index);
                    if(res.status != 1){
                        $(".code-btn").trigger("bc.clear");
                    }
                    layer.msg(res.msg);
                })
                return false;
            });
        });

        (function($, doc) {
            $.init();
            $.ready(function() {
                //普通示例
                var userPicker = new $.PopPicker();
                userPicker.setData([{
                    value: '1',
                    text: '男'
                }, {
                    value: '2',
                    text: '女'
                }]);
                var showUserPickerButton = doc.getElementById('showUserPicker');
                var sex = document.getElementById("sex");
                showUserPickerButton.addEventListener('tap', function(event) {
                    userPicker.show(function(items) {
                        sex.value = items[0]['value'];
                        showUserPickerButton.innerText = items[0]['text'];
                        //返回 false 可以阻止选择框的关闭
                        //return false;
                    });
                }, false);                                   
            });

            var btns = $('.birthday-select');
            btns.each(function(i, btn) {
                btn.addEventListener('tap', function() {
                    var optionsJson = this.getAttribute('data-options') || '{}';
                    var options = JSON.parse(optionsJson);
                    var id  = doc.getElementById('birthday-select');
                    var birthday = document.getElementById("birthday");
                    /*
                     * 首次显示时实例化组件
                     * 示例为了简洁，将 options 放在了按钮的 dom 上
                     * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
                     */
                    var picker = new $.DtPicker(options);
                    picker.show(function(rs) {
                        /*
                         * rs.value 拼合后的 value
                         * rs.text 拼合后的 text
                         * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
                         * rs.m 月，用法同年
                         * rs.d 日，用法同年
                         * rs.h 时，用法同年
                         * rs.i 分（minutes 的第二个字母），用法同年
                         */
                        birthday.value  = rs.text;
                        id.innerText    = rs.text;
                        /* 
                         * 返回 false 可以阻止选择框的关闭
                         * return false;
                         */
                        /*
                         * 释放组件资源，释放后将将不能再操作组件
                         * 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
                         * 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
                         * 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
                         */
                        picker.dispose();
                    });
                }, false);
            });
        })(mui, document);
    </script>
    <script type="text/javascript">
        var shareTitel  = '';
        var shareDesc   = '';
        var shareLink   = 'http://'+window.location.hostname+'/app/account/index/login/invitor/{$member.id}/mid/{$mpInfo.id}';
        var shareImgUrl = 'http://'+window.location.hostname+'/addons/account/static/images/login-logo.jpg';
        wx.ready(function(){
            wx.onMenuShareTimeline({
                title: shareTitel, // 分享标题
                link: shareLink, // 分享链接
                imgUrl: shareImgUrl, // 分享图标
                success: function () { 

                },
                cancel: function () { 
                
                }
            });
          wx.onMenuShareAppMessage({
              title: shareTitel, // 分享标题
              desc: shareDesc, // 分享描述
              link: shareLink, // 分享链接
              imgUrl: shareImgUrl, // 分享图标
              type: '', // 分享类型,music、video或link，不填默认为link
              dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
              success: function () { 
                   
              },
              cancel: function () { 

              }
          });
            wx.onMenuShareQQ({
              title: shareTitel, // 分享标题
              desc: shareDesc, // 分享描述
              link: shareLink, // 分享链接
              imgUrl: shareImgUrl, // 分享图标
              success: function () { 
                                   
              },
              cancel: function () { 
                
              }
          });
          wx.onMenuShareWeibo({
              title: shareTitel, // 分享标题
              desc: shareDesc, // 分享描述
              link: shareLink, // 分享链接
              imgUrl: shareImgUrl, // 分享图标
              success: function () { 
                                  
              },
              cancel: function () { 
                
              }
          });
          wx.onMenuShareQZone({
              title: shareTitel, // 分享标题
              desc: shareDesc, // 分享描述
              link: shareLink, // 分享链接
              imgUrl: shareImgUrl, // 分享图标
              success: function () { 
                                 
              },
              cancel: function () { 

              }
          });
        });
    </script>
</html>